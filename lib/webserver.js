// Generated by CoffeeScript 1.3.3
(function() {
  var Identity, Logger, WebServer, formidable, generate_identity, restify, _ref,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Logger = require('./logger');

  restify = require('restify');

  formidable = require('formidable');

  _ref = require('./identity'), Identity = _ref.Identity, generate_identity = _ref.generate_identity;

  WebServer = (function() {

    function WebServer(port, pkg_info) {
      this.port = port != null ? port : 8080;
      this.pkg_info = pkg_info;
      this.setup_routes = __bind(this.setup_routes, this);

      this.logger = Logger.get();
      this.identity = Identity.get();
      this.app = restify.createServer();
      this.setup_routes();
      this.app.listen(this.port);
      this.logger.info("Webserver is up at: http://0.0.0.0:" + this.port);
    }

    WebServer.prototype.setup_routes = function() {
      var _this = this;
      this.app.get('/', function(req, res) {
        return res.json(200, {
          name: _this.pkg_info.name,
          version: _this.pkg_info.version
        });
      });
      this.app.get('/branches', function(req, res) {
        return res.json(200, {
          name: "branches",
          branches: []
        });
      });
      this.app.get('/tags', function(req, res) {
        return res.json(200, {
          name: "tags",
          tags: []
        });
      });
      return this.app.post('/test', function(req, res) {
        var form;
        this.logger.info(req);
        form = formidable.IncomingForm();
        return form.parse(req, function(err, fields, files) {
          return res.json(200, {
            message: "Recieved Upload",
            fields: fields,
            files: files
          });
        });
      });
    };

    return WebServer;

  })();

  module.exports = WebServer;

}).call(this);
